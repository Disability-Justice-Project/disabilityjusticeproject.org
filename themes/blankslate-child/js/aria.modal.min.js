!function(t,e,a){"use strict";var i={};t.ARIAmodal=i,i.NS="ARIAmodal",i.AUTHOR="Scott O'Hara",i.VERSION="3.1.1",i.LICENSE="https://github.com/scottaohara/accessible_modal_window/blob/master/LICENSE";var o,l,d="modal-open",r=e.body,n=e.getElementsByTagName("main")[0],s=e.querySelectorAll("[data-modal]"),u=e.querySelectorAll("body > *:not([data-modal])"),c=!1,b=!1,h="js-first-focus",g="js-last-focus";i.organizeDOM=function(){var t,e=r.firstElementChild||null;for(t=0;t<s.length;t++)r.insertBefore(s[t],e)},i.setupTrigger=function(){var t,a,o=e.querySelectorAll("[data-modal-open]");for(a=0;a<o.length;a++){var l=(t=o[a]).getAttribute("data-modal-open");if("BUTTON"!==t.nodeName){var d=t.getAttribute("href");t.setAttribute("role","button"),0===t.getAttribute("tabindex")||t.hasAttribute("href")||(t.tabIndex=0),""===l&&d&&(t.setAttribute("data-modal-open",d.split("#")[1]),l=d.split("#")[1])}l?(t.hasAttribute("disabled")&&!t.hasAttribute("data-modal-disabled")&&t.removeAttribute("disabled"),t.removeAttribute("hidden"),t.id=l+"__trigger-"+t.nodeName,t.addEventListener("click",i.openModal),t.addEventListener("keydown",i.keyEvents,!1)):console.warn('Missing target modal dialog - [data-modal-open="IDREF"]')}},i.setupModal=function(){var t;for(t=0;t<s.length;t++){var e,a=(e=s[t]).getAttribute("data-modal"),o=e.getAttribute("data-modal-class")||"a11y-modal",l=e.querySelector("h1")||e.querySelector("h2")||e.querySelector("h3")||e.querySelector("h4"),d=e.getAttribute("data-modal-label"),r=e.hasAttribute("data-modal-hide-heading"),n=e.querySelector("[data-modal-description]");if("alert"===a?e.setAttribute("role","alertdialog"):e.setAttribute("role","dialog"),e.classList.add(o),e.setAttribute("hidden",""),e.tabIndex="-1",i.setupModalCloseBtn(e,o,a),e.hasAttribute("data-aria-modal")&&e.setAttribute("aria-modal","true"),n&&(n.id=n.id||"md_desc_"+Math.floor(999*Math.random())+1,e.setAttribute("aria-describedby",n.id)),d)e.setAttribute("aria-label",d);else if(l){var u=e.id+"_heading";l.classList.add(o+"__heading"),l.id=u,e.setAttribute("aria-labelledby",u),l.hasAttribute("data-autofocus")&&l.setAttribute("tabindex","-1")}else console.warn("Dialogs should have their purpose conveyed by a heading element (h1).");r&&e.querySelector("#"+l.id).classList.add("at-only");var c=e.querySelectorAll('button:not([hidden]), [href]:not([hidden]), input:not([hidden]), select:not([hidden]), textarea:not([hidden]), [tabindex="0"]:not([hidden]), summary, [contenteditable]:not([hidden]), audio[controls], video[controls]');c[0].classList.add(h),c[c.length-1].classList.add(g)}},i.setupModalCloseBtn=function(t,a,o){var l,d=t.querySelectorAll("[data-modal-close-btn]"),r=t.getAttribute("data-modal-close"),n=t.getAttribute("data-modal-close-class");if(d.length<2){var s=e.createElement("button");s.setAttribute("type","button"),t.classList.add(a),s.classList.add(a+"__close-btn"),r||"alert"===o?(s.innerHTML=r,n&&s.classList.add(n)):(s.innerHTML="<span data-modal-x></span>",s.setAttribute("aria-label","Close"),s.classList.add("is-icon-btn")),"alert"!==o&&t.appendChild(s),s.addEventListener("click",i.closeModal)}for(l=0;l<d.length;l++)d[l].addEventListener("click",i.closeModal);e.addEventListener("keydown",i.keyEvents,!1)},i.openModal=function(t,a){var n,s=a||this.getAttribute("data-modal-open"),h=l=e.getElementById(s),g=l.querySelector("[autofocus]")||l.querySelector("[data-autofocus]");if(c=l.hasAttribute("aria-modal"),a&&(b=!0),a||(t.preventDefault(),o=this.id),g?h=g:l.hasAttribute("data-modal-close-focus")&&(h=l.querySelector('[class*="close-btn"]')),r.classList.contains(d))console.warn("It is not advised to open dialogs from within other dialogs. Instead consider replacing the contents of this dialog with new content. Or providing a stepped, or tabbed interface within this dialog.");else for(r.classList.add(d),n=0;n<u.length;n++)c||(u[n].hasAttribute("aria-hidden")&&u[n].setAttribute("data-keep-hidden",u[n].getAttribute("aria-hidden")),u[n].setAttribute("aria-hidden","true")),u[n].getAttribute("inert")?u[n].setAttribute("data-keep-inert",""):u[n].setAttribute("inert","true");return l.removeAttribute("hidden"),h.focus(),e.addEventListener("click",i.outsideClose,!1),e.addEventListener("touchend",i.outsideClose,!1),[o,l,b]},i.closeModal=function(t){var i,c,h=e.getElementById(o)||null;for(i=0;i<u.length;i++)u[i].hasAttribute("data-keep-inert")||u[i].removeAttribute("inert"),u[i].removeAttribute("data-keep-inert"),u[i].getAttribute("data-keep-hidden")?u[i].setAttribute("aria-hidden",u[i].getAttribute("data-keep-hidden")):u[i].removeAttribute("aria-hidden"),u[i].removeAttribute("data-keep-hidden");for(r.classList.remove(d),c=0;c<s.length;c++)s[c].hasAttribute("hidden")||s[c].setAttribute("hidden","");return null!==h?h.focus():n&&!b?(n.tabIndex=-1,n.focus()):(r.tabIndex=-1,r.focus()),[o=a,l=a,b=!1]},i.keyEvents=function(t){var a=t.keyCode||t.which;if(t.target.hasAttribute("data-modal-open"))switch(a){case 13:case 32:t.preventDefault(),t.target.click()}if(r.classList.contains(d)){switch(a){case 27:i.closeModal()}if(r.classList.contains(d))var o=l.querySelector("."+h),n=l.querySelector("."+g);e.activeElement.classList.contains(g)&&(9!==a||t.shiftKey||(t.preventDefault(),o.focus())),e.activeElement.classList.contains(h)&&9===a&&t.shiftKey&&(t.preventDefault(),n.focus())}},i.outsideClose=function(t){r.classList.contains(d)&&!t.target.hasAttribute("data-modal-open")&&(l.contains(t.target)||"alertdialog"===l.getAttribute("role")||i.closeModal())},i.autoLoad=function(){var a,o=e.querySelectorAll("[data-modal-auto]"),l=t.location.hash||null,d=!1;if(null!==l){if(""===(a=l.split("#")[1]))return!1;if("!null"===a)return!1;var r=e.getElementById(a)||null;null!==r&&("dialog"!==r.getAttribute("role")&&"alertdialog"!==r.getAttribute("role")||(d=!0))}d?(i.openModal(null,a),o.length>1&&console.warn("Only the modal indicated by the hash value will load.")):"dialog"===o[0].getAttribute("role")||"alertdialog"===o[0].getAttribute("role")?(a=o[0].id,i.openModal(null,a),o.length>1&&console.warn("Multiple modal dialogs can not auto load.")):"button"!==o[0].getAttribute("role")&&"BUTTON"!==o[0].tagName||(a=o[0].id,o[0].click()),e.getElementById(a).hasAttribute("data-modal-auto-persist")||t.location.replace("#!null")},i.init=function(){i.organizeDOM(),i.setupTrigger(),i.setupModal(),i.autoLoad()},i.init()}(window,document);
